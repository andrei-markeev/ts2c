#!/usr/bin/env node

var path = require('path');
var fs = require('fs');
var ts2c = require(path.join(__dirname, "../ts2c.js"));

if (process.argv.length < 3) {
    console.log("Usage: ts2c <path/to/file.ts>")
    process.exit();
}

var multiFiles = true;
var fileName = null;

for (var i = 2; i < process.argv.length; i++) {
    var arg = process.argv[i];
    if (arg === '-v' || arg === '--version') {
        const packageJson = require(path.join(__dirname, "../package.json"));
        console.log(packageJson.version);
        process.exit(0);
    } else if (arg === '-s' || arg === '--single-file') {
        multiFiles = false;
    } else
        fileName = arg;
}
var sourceCode = fs.readFileSync(fileName, 'utf-8');

if (multiFiles) {
    var files = ts2c.transpile(sourceCode, { fileName, terminal: true, multiFiles });
    for (var file of files)
        fs.writeFileSync(file.fileName, file.source);
} else {
    var transpiledCode = ts2c.transpile(sourceCode, { fileName, terminal: true });
    fs.writeFileSync(fileName.replace(/(\.ts|\.js)$/) + '.c', transpiledCode);
}

process.exit();
